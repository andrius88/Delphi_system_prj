object dmDataModule: TdmDataModule
  OldCreateOrder = False
  OnCreate = DataModuleCreate
  Height = 452
  Width = 738
  object upSystem: TZUpdateSQL
    DeleteSQL.Strings = (
      'DELETE FROM private.system'
      'WHERE'
      '  system.code = :OLD_code')
    InsertSQL.Strings = (
      'INSERT INTO private.system'
      '  (code, description)'
      'VALUES'
      '  (:code, :description)')
    ModifySQL.Strings = (
      'UPDATE private.system SET'
      '  code = :code,'
      '  description = :description'
      'WHERE'
      '  system.code = :OLD_code')
    UseSequenceFieldForRefreshSQL = False
    Left = 96
    Top = 80
    ParamData = <
      item
        DataType = ftUnknown
        Name = 'code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'description'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'OLD_code'
        ParamType = ptUnknown
      end>
  end
  object dsSystem: TDataSource
    DataSet = qSystem
    Left = 136
    Top = 32
  end
  object qSystem: TZQuery
    Connection = conn
    AfterScroll = qSystemAfterScroll
    UpdateObject = upSystem
    Active = True
    SQL.Strings = (
      'SELECT '
      '  code, '
      '  CAST(description AS VARCHAR(50)) AS description'
      'FROM'
      '  private.system'
      'ORDER BY'
      '  description')
    Params = <>
    Left = 88
    Top = 32
    object qSystemcode: TWideStringField
      FieldName = 'code'
      Required = True
      Size = 40
    end
    object qSystemdescription: TWideStringField
      FieldName = 'description'
      Size = 100
    end
  end
  object conn: TZConnection
    ControlsCodePage = cCP_UTF16
    UTF8StringsAsWideField = True
    Connected = True
    HostName = 'dbdev.nsoft.eu'
    Port = 5435
    Database = 'update_prod'
    User = 'update_server_owner'
    Password = '0sEgVwDnSHi6'
    Protocol = 'postgresql-9'
    Left = 40
    Top = 32
  end
  object dsModule: TDataSource
    DataSet = qModule
    Left = 312
    Top = 40
  end
  object qModule: TZQuery
    Connection = conn
    AfterInsert = qModuleAfterInsert
    Active = True
    SQL.Strings = (
      'SELECT '
      
        '  system_code, code, CAST (description AS CHARACTER VARYING(40))' +
        ', mandatory '
      'FROM private.module '
      'WHERE'
      '  system_code = :prm_system '
      'ORDER BY'
      '  code')
    Params = <
      item
        DataType = ftUnknown
        Name = 'prm_system'
        ParamType = ptUnknown
      end>
    Left = 248
    Top = 40
    ParamData = <
      item
        DataType = ftUnknown
        Name = 'prm_system'
        ParamType = ptUnknown
      end>
    object qModulesystem_code: TWideStringField
      FieldName = 'system_code'
      Required = True
      Size = 40
    end
    object qModulecode: TWideStringField
      FieldName = 'code'
      Required = True
      Size = 40
    end
    object qModuledescription: TWideStringField
      FieldName = 'description'
      Required = True
      Size = 80
    end
    object qModulemandatory: TBooleanField
      FieldName = 'mandatory'
      Required = True
    end
  end
  object qSystemVersion: TZQuery
    Connection = conn
    BeforeOpen = qSystemVersionBeforeOpen
    AfterScroll = qSystemVersionAfterScroll
    UpdateObject = upSystemVersion
    AfterPost = qSystemVersionAfterPost
    Active = True
    SQL.Strings = (
      'SELECT '
      '  public.ver4_to_str("version")::::varchar(100) as version'
      'FROM '
      '  private.system_version '
      'WHERE '
      '  system_code = :prm_system'
      'ORDER BY'
      '  version  ')
    Params = <
      item
        DataType = ftUnknown
        Name = 'prm_system'
        ParamType = ptUnknown
      end>
    Left = 40
    Top = 136
    ParamData = <
      item
        DataType = ftUnknown
        Name = 'prm_system'
        ParamType = ptUnknown
      end>
    object qSystemVersionversion: TWideStringField
      FieldName = 'version'
      Size = 200
    end
  end
  object upSystemVersion: TZUpdateSQL
    DeleteSQL.Strings = (
      'DELETE FROM private.system_version'
      'WHERE'
      '  system_version.system_code = :prm_system_code2 AND'
      '  system_version.version = public.str_to_ver4( :OLD_version)'
      '')
    InsertSQL.Strings = (
      'INSERT INTO private.system_version'
      '  (system_code, version)'
      'VALUES'
      '  (:prm_system_code,  public.str_to_ver4(:version))'
      '')
    ModifySQL.Strings = (
      'UPDATE private.system_version '
      'SET'
      '  version =public.str_to_ver4( :version)'
      'WHERE'
      '  system_version.system_code = :prm_system_code3 AND'
      '  system_version.version = public.str_to_ver4(:OLD_version)')
    UseSequenceFieldForRefreshSQL = False
    BeforeDeleteSQL = upSystemVersionBeforeDeleteSQL
    BeforeInsertSQL = upSystemVersionBeforeInsertSQL
    BeforeModifySQL = upSystemVersionBeforeModifySQL
    Left = 64
    Top = 160
    ParamData = <
      item
        DataType = ftUnknown
        Name = 'version'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_system_code3'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'OLD_version'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_system_code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_system_code2'
        ParamType = ptUnknown
      end>
  end
  object dsSystemVersion: TDataSource
    DataSet = qSystemVersion
    Left = 120
    Top = 144
  end
  object qModuleVersion: TZQuery
    Connection = conn
    BeforeOpen = qModuleVersionBeforeOpen
    BeforeScroll = qModuleVersionBeforeScroll
    AfterScroll = qModuleVersionAfterScroll
    UpdateObject = upModuleVersion
    CachedUpdates = True
    Active = True
    SQL.Strings = (
      'SELECT '
      '  CAST(module_code AS VARCHAR(20)) AS module_code,'
      
        '  public.ver4_to_str("module_version")::::varchar(100) as versio' +
        'n'
      ' FROM '
      '  private.system_composition'
      'WHERE '
      '  system_code =:prm_system '
      '  AND system_version =str_to_ver4(:prm_system_version)'
      'ORDER BY'
      ' module_code')
    Params = <
      item
        DataType = ftUnknown
        Name = 'prm_system'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_system_version'
        ParamType = ptUnknown
      end>
    Left = 232
    Top = 136
    ParamData = <
      item
        DataType = ftUnknown
        Name = 'prm_system'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_system_version'
        ParamType = ptUnknown
      end>
    object qModuleVersionmodule_code: TWideStringField
      FieldName = 'module_code'
      Required = True
      Size = 40
    end
    object qModuleVersionversion: TWideStringField
      FieldName = 'version'
      Size = 200
    end
  end
  object upModuleVersion: TZUpdateSQL
    DeleteSQL.Strings = (
      'Select public.pgp_pub_check_module_version('
      '  3,'
      '  :prm_system_code, '
      '   public.str_to_ver4(:prm_system_version),'
      '   :module_code,'
      '    public.str_to_ver4(:version),'
      '   CAST(NULL AS character varying),'
      '   CAST(NULL AS ver4)'
      ')')
    InsertSQL.Strings = (
      'Select public.pgp_pub_check_module_version('
      '  1,'
      '  :prm_system_code, '
      '   public.str_to_ver4(:prm_system_version),'
      '   :module_code,'
      '    public.str_to_ver4(:version),'
      '   CAST(NULL AS character varying),'
      '   CAST(NULL AS ver4)'
      ')')
    ModifySQL.Strings = (
      'Select public.pgp_pub_check_module_version('
      '  2,'
      '  :prm_system_code, '
      '   public.str_to_ver4(:prm_system_version),'
      '   :module_code,'
      '    public.str_to_ver4(:version),'
      '   :OLD_module_code,'
      '   public.str_to_ver4(:OLD_version)'
      ')'
      '')
    UseSequenceFieldForRefreshSQL = False
    BeforeDeleteSQL = upModuleVersionBeforeDeleteSQL
    BeforeInsertSQL = upModuleVersionBeforeInsertSQL
    BeforeModifySQL = upModuleVersionBeforeModifySQL
    Left = 264
    Top = 160
    ParamData = <
      item
        DataType = ftUnknown
        Name = 'prm_system_code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_system_version'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'module_code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'version'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'OLD_module_code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'OLD_version'
        ParamType = ptUnknown
      end>
  end
  object dsModuleVersion: TDataSource
    DataSet = qModuleVersion
    Left = 312
    Top = 136
  end
  object qModuleVerDiffInsrt: TZQuery
    Connection = conn
    SQL.Strings = (
      'INSERT INTO private.module_version_diff '
      
        '  (system_code, module_code, "version", destination_path, file_c' +
        'ontent)'
      
        'VALUES (:prm_system_code, :prm_module_code, str_to_ver4(:prm_mod' +
        'ule_ver),'
      '  :prm_dir_name,:prm_blob);')
    Params = <
      item
        DataType = ftUnknown
        Name = 'prm_system_code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_module_code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_module_ver'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_dir_name'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_blob'
        ParamType = ptUnknown
      end>
    Left = 216
    Top = 208
    ParamData = <
      item
        DataType = ftUnknown
        Name = 'prm_system_code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_module_code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_module_ver'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_dir_name'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_blob'
        ParamType = ptUnknown
      end>
  end
  object qModuleVerDiff: TZQuery
    Connection = conn
    SQL.Strings = (
      'SELECT '
      '  CAST(destination_path AS VARCHAR(50)), '
      '  octet_length(file_content) AS size_in_bytes'
      'FROM '
      '  private.module_version_diff '
      'WHERE'
      
        '  system_code = :prm_system_code AND module_code = :prm_module_c' +
        'ode'
      '  AND "version" = str_to_ver4(:prm_module_ver)'
      'ORDER BY destination_path ')
    Params = <
      item
        DataType = ftUnknown
        Name = 'prm_system_code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_module_code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_module_ver'
        ParamType = ptUnknown
      end>
    Left = 216
    Top = 256
    ParamData = <
      item
        DataType = ftUnknown
        Name = 'prm_system_code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_module_code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_module_ver'
        ParamType = ptUnknown
      end>
    object qModuleVerDiffdestination_path: TWideStringField
      DisplayLabel = 'Path'
      DisplayWidth = 112
      FieldName = 'destination_path'
      Required = True
      Size = 100
    end
    object qModuleVerDiffsize_in_bytes: TIntegerField
      DisplayLabel = 'Size'
      DisplayWidth = 13
      FieldName = 'size_in_bytes'
      ReadOnly = True
    end
  end
  object qModuleVerDiffDel: TZQuery
    Connection = conn
    SQL.Strings = (
      'DELETE FROM private.module_version_diff '
      'WHERE '
      '  system_code = :prm_system  AND '
      '  module_code = :prm_module_code AND '
      '  destination_path = :prm_dir_path;')
    Params = <
      item
        DataType = ftUnknown
        Name = 'prm_system'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_module_code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_dir_path'
        ParamType = ptUnknown
      end>
    Left = 288
    Top = 216
    ParamData = <
      item
        DataType = ftUnknown
        Name = 'prm_system'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_module_code'
        ParamType = ptUnknown
      end
      item
        DataType = ftUnknown
        Name = 'prm_dir_path'
        ParamType = ptUnknown
      end>
  end
  object dsModuleVerDiff: TDataSource
    DataSet = qModuleVerDiff
    Left = 304
    Top = 256
  end
  object qDropBox: TZQuery
    Connection = conn
    SQL.Strings = (
      'SELECT '
      '  system_code, '
      '  code '
      'FROM '
      '  private.module'
      'WHERE '
      '  system_code= :prm_system'
      'ORDER BY'
      '  code')
    Params = <
      item
        DataType = ftUnknown
        Name = 'prm_system'
        ParamType = ptUnknown
      end>
    DataSource = dsModule
    LinkedFields = 'code'
    Left = 392
    Top = 136
    ParamData = <
      item
        DataType = ftUnknown
        Name = 'prm_system'
        ParamType = ptUnknown
      end>
    object qDropBoxsystem_code: TWideStringField
      FieldName = 'system_code'
      Required = True
      Size = 40
    end
    object qDropBoxcode: TWideStringField
      FieldName = 'code'
      Required = True
      Size = 40
    end
  end
  object dsComboBox: TDataSource
    DataSet = qDropBox
    Left = 456
    Top = 136
  end
end
